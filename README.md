# LZ快捷人格生成器

> AI 驱动的人格生成、优化、画像工具

一个 AstrBot 插件，让你可以通过简单的命令快速生成、优化和管理 AI 人格，无需手动编写复杂的提示词。

## ✨ 功能特性

### 已实现
- 🎭 **人格生成** - 根据简单描述自动生成完整的人格提示词
- 🔧 **人格优化** - 根据反馈智能调整现有人格
- 📦 **提示词瘦身** - 压缩提示词以节省 Token（支持轻度/中度/极限三档）
- ✅ **确认机制** - 生成后预览，确认后才应用，避免误操作
- 💾 **版本备份** - 自动备份历史版本，支持一键回滚
- 🔗 **原生对接** - 与 AstrBot 原生 Persona 系统无缝集成

### 开发中
- 🎨 **人格画像** - 从聊天记录中提取用户画像生成人格
- 🔍 **自省功能** - 分析对话历史检测人格漂移

## 📖 命令列表

### 生成与优化
| 命令 | 说明 | 示例 |
|------|------|------|
| `/快捷人格 生成人格 <描述>` | 根据描述生成人格 | `/快捷人格 生成人格 一个温柔的猫娘` |
| `/快捷人格 优化人格 <反馈>` | 根据反馈优化当前人格 | `/快捷人格 优化人格 说话再可爱一点` |
| `/快捷人格 压缩人格 [强度]` | 压缩人格提示词 | `/快捷人格 压缩人格 中度` |

### 管理
| 命令 | 说明 |
|------|------|
| `/快捷人格 查看状态` | 查看当前状态 |
| `/快捷人格 确认应用` | 应用待确认的人格 |
| `/快捷人格 取消操作` | 取消待确认的人格 |
| `/快捷人格 历史版本 [人格ID]` | 查看历史版本列表 |
| `/快捷人格 版本回滚 [人格ID]` | 回滚到上一个版本 |
| `/快捷人格 人格列表` | 列出所有人格 |
| `/快捷人格 查看详情 [人格ID]` | 查看人格详情 |
| `/快捷人格 选择人格 <人格ID>` | 选择一个人格（后续操作的目标） |
| `/快捷人格 激活人格 [人格ID]` | **激活人格到当前对话** |
| `/快捷人格 新建对话 [人格ID]` | **新建对话并激活人格** |
| `/快捷人格 删除人格 <人格ID>` | 删除人格 |
| `/快捷人格 使用帮助` | 显示帮助 |

### 别名支持
- `/qp` 或 `/quickpersona` 作为命令前缀
- 例如: `/qp gen 一个猫娘` 等同于 `/快捷人格 生成人格 一个猫娘`

## 🚀 快速开始

1. 安装插件到 AstrBot
2. 使用命令生成人格：
   ```
   /快捷人格 生成人格 一个毒舌但内心温柔的傲娇少女
   ```
3. 预览生成结果，满意后确认：
   ```
   /快捷人格 确认应用
   ```
4. 激活人格到当前对话：
   ```
   /快捷人格 激活人格
   ```
5. AI 的下一条回复就会使用新人格了！

## ⚙️ 配置项

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `enabled` | 启用插件 | `true` |
| `architect_provider_id` | 架构师模型 Provider ID | 空（使用默认） |
| `max_prompt_length` | 人格提示词最大字符数 | `800` |
| `auto_compress` | 生成后自动压缩提示词 | `true` |
| `confirm_before_apply` | 应用人格前需要确认 | `true` |
| `backup_versions` | 历史版本保留数量 | `5` |
| `architect_timeout` | 架构师模型超时时间(秒) | `60` |

## 💡 使用技巧

### 1. 生成高质量人格
- 描述越具体，生成效果越好
- 可以包含：角色背景、性格特点、说话风格、独特之处
- 示例：`/快捷人格 生成人格 一个喜欢用颜文字的二次元宅女，说话经常夹杂日语，有点社恐但对熟人很话痨`

### 2. 迭代优化
- 生成后不满意？使用 `/快捷人格 优化人格` 继续调整
- 可以多次优化直到满意
- 每次优化都会自动备份上一版本

### 3. 节省 Token
- 使用 `/快捷人格 压缩人格` 压缩提示词
- 轻度：去除冗余表述
- 中度：转换为结构化格式
- 极限：极简键值对形式

## 🔧 技术细节

### 与 AstrBot 原生系统的关系
- **PersonaManager** - 管理人格（提示词），创建的人格与控制台完全互通
- **ConversationManager** - 管理对话，可以为对话指定人格
- 人格 ID 以 `lz_` 前缀标识，方便区分插件创建的人格

### 备份存储结构
历史版本存储在 AstrBot data 目录的 **plugin_data** 文件夹中（独立于插件安装目录，防止卸载时数据丢失）：

```
data/plugin_data/astrbot_plugin_lzpersona/
├── backups/
│   ├── lz_猫娘_abc123/
│   │   ├── v001_20260202_123456.txt  # 版本1: 完整提示词内容
│   │   ├── v002_20260202_134500.txt  # 版本2
│   │   └── ...
│   └── lz_傲娇_def456/
│       └── ...
```

**为什么使用 plugin_data 目录？**
- 插件卸载时不会删除此目录
- 重新安装插件后可以恢复历史数据
- 便于用户手动备份/迁移数据

## 📋 更新日志

### v1.0.0
- 初始版本
- 实现人格生成、优化、压缩功能
- 实现确认机制和版本备份
- 与 AstrBot 原生 Persona 系统无缝集成

## 📝 License

MIT License
